<!DOCTYPE html>
<html class="dark" lang="ko">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>FERRARI HTS ULTIMATE v3.0.0 - ÌÜµÌï© ÏßÄÌúò ÏÑºÌÑ∞</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#25e2f4",
                        "background-dark": "#0a0c0c",
                        "panel-dark": "#131b1c",
                        "trading-red": "#f43f5e",
                        "trading-blue": "#3b82f6",
                        "success": "#0bda54",
                        "risk-amber": "#f59e0b",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "Noto Sans KR", "sans-serif"]
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Space Grotesk', 'Noto Sans KR', sans-serif;
            background-color: #0a0c0c;
            color: white;
            -webkit-font-smoothing: antialiased;
        }

        .ios-blur {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .pulse-cyan {
            animation: pulse-cyan 2s infinite;
        }

        @keyframes pulse-cyan {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: .5;
                transform: scale(1.1);
            }
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="overflow-x-hidden selection:bg-primary/30">
    <div class="flex flex-col min-h-screen max-w-[430px] mx-auto border-x border-white/10 relative pb-20">

        <!-- Header: Unified Stat Bar -->
        <header class="sticky top-0 z-[100] bg-background-dark/90 ios-blur border-b border-primary/20 p-4">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-primary pulse-cyan"></div>
                    <h1 class="text-[10px] font-black tracking-[0.3em] text-primary uppercase">HTS Ultimate v3.0.0</h1>
                </div>
                <span id="server_time" class="text-[9px] font-mono text-white/40">--:--:--</span>
            </div>

            <!-- Tri-Engine Balances Grid -->
            <div class="grid grid-cols-3 gap-2 mb-4">
                <div class="bg-white/5 rounded-lg p-2 border border-white/5">
                    <p class="text-[7px] text-white/30 uppercase font-bold">Real Account</p>
                    <p id="balance_real" class="text-[10px] font-black text-white/60">0 KRW</p>
                </div>
                <div class="bg-primary/5 rounded-lg p-2 border border-primary/20">
                    <p class="text-[7px] text-primary/50 uppercase font-bold">Virtual Sim</p>
                    <p id="balance_virtual" class="text-[10px] font-black text-primary">$10,000</p>
                </div>
                <div class="bg-success/5 rounded-lg p-2 border border-success/20">
                    <p class="text-[7px] text-success/50 uppercase font-bold">Mock Invest</p>
                    <p id="balance_mock" class="text-[10px] font-black text-success">0 KRW</p>
                </div>
            </div>

            <div class="flex items-center justify-between">
                <div>
                    <p class="text-[9px] text-white/30 uppercase font-bold tracking-tight">Active Target</p>
                    <div class="flex items-baseline gap-2">
                        <span id="equity_total" class="text-xl font-black text-white">$10,000</span>
                        <span id="equity_profit" class="text-[10px] font-bold text-success">+0.00%</span>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-[9px] text-white/30 uppercase font-bold tracking-tight">Active Engine</p>
                    <p id="engine_mode" class="text-xs font-black text-primary italic">TRI-ENGINE_v7.0</p>
                </div>
            </div>
        </header>

        <!-- Main Dashboard Controller -->
        <main class="flex-1">

            <!-- Tab: HOME ( ÏßÄÌúòÎ∂Ä ) -->
            <section id="tab-home" class="tab-content active p-4 space-y-6">
                <!-- Summary Card -->
                <div class="glass-card rounded-2xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <span class="material-symbols-outlined text-4xl">hub</span>
                    </div>
                    <p class="text-[10px] font-bold text-white/40 uppercase tracking-[0.2em] mb-4">Command Center
                        Summary</p>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <p class="text-[9px] text-white/40 mb-1 font-bold">TICKS COLLECTED</p>
                            <p id="home_tick_total" class="text-xl font-black text-primary">0</p>
                        </div>
                        <div>
                            <p class="text-[9px] text-white/40 mb-1 font-bold">DAILY P/L</p>
                            <p class="text-xl font-black text-success">+$0.00</p>
                        </div>
                    </div>
                </div>

                <!-- Live Signal Radar Preview -->
                <div class="space-y-3">
                    <h3 class="text-[10px] font-bold text-white/30 tracking-widest uppercase flex items-center gap-2">
                        <span class="material-symbols-outlined text-xs">radar</span> High Confidence Radar
                    </h3>
                    <div id="home_radar_list" class="space-y-2">
                        <!-- Items populated by JS -->
                    </div>
                </div>

                <!-- Panopticon Intelligence Feed (Surveillance) -->
                <div class="space-y-3">
                    <h3
                        class="text-[10px] font-bold text-white/30 tracking-widest uppercase flex items-center justify-between">
                        <div class="flex items-center gap-2"><span
                                class="material-symbols-outlined text-xs">visibility</span> Panopticon Intelligence Feed
                        </div>
                        <span class="text-[8px] bg-primary/10 text-primary px-1.5 py-0.5 rounded">24/7 LIVE</span>
                    </h3>
                    <div id="panopticon_feed"
                        class="bg-black/60 border border-primary/10 rounded-xl p-4 font-mono text-[9px] h-64 overflow-y-auto scrollbar-hide space-y-2">
                        <!-- Intelligence Reports -->
                        <div class="text-white/20 italic text-center py-8">Initializing Panopticon Neural Link...</div>
                    </div>
                </div>
            </section>

            <!-- Tab: MARKET ( Í¥ÄÏã¨Ï¢ÖÎ™© ) -->
            <section id="tab-market" class="tab-content p-4 space-y-4">
                <div class="flex items-center justify-between sticky top-[92px] bg-background-dark z-40 py-2">
                    <h2 class="text-sm font-bold tracking-widest uppercase text-primary">Interest Stocks (Í¥ÄÏã¨Ï¢ÖÎ™©)</h2>
                    <div class="flex bg-white/5 rounded-lg p-1">
                        <button class="px-3 py-1 bg-primary text-background-dark text-[9px] font-bold rounded">TOP
                            100</button>
                        <button class="px-3 py-1 text-white/40 text-[9px] font-bold rounded">WATCHLIST</button>
                    </div>
                </div>
                <div id="market_radar_list" class="space-y-2">
                    <!-- Radar List -->
                </div>
            </section>

            <!-- Tab: TRADE ( Ï£ºÎ¨∏ ) -->
            <section id="tab-trade" class="tab-content p-4 space-y-4">
                <!-- Ticker Header -->
                <div class="flex items-center justify-between border-b border-white/5 pb-3">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center font-black text-primary text-xs">
                            NVDA
                        </div>
                        <div>
                            <h2 class="text-base font-bold leading-none mb-0.5">ÏóîÎπÑÎîîÏïÑ</h2>
                            <p class="text-[9px] text-white/30">NVIDIA | NASDAQ</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p id="trade_current_price" class="text-lg font-black text-trading-red">$852.40</p>
                        <p class="text-[9px] text-trading-red font-bold">‚ñ≤ 12.4%</p>
                    </div>
                </div>

                <!-- Real-time 10-Level Order Book (Hoga) -->
                <div class="space-y-1">
                    <div class="flex justify-between text-[8px] text-white/30 font-bold px-2 mb-1">
                        <span>PRICE</span>
                        <span>QUANTITY</span>
                    </div>
                    <!-- Ask Levels (Îß§ÎèÑÌò∏Í∞Ä - Blue) -->
                    <div id="trade_asks" class="space-y-0.5">
                        <!-- Populated by JS -->
                    </div>
                    <!-- Current Price Separator -->
                    <div
                        class="h-8 bg-gradient-to-r from-trading-blue/20 via-white/10 to-trading-red/20 rounded flex items-center justify-center">
                        <span id="trade_spread" class="text-[9px] font-bold text-white/60">Spread: $0.05</span>
                    </div>
                    <!-- Bid Levels (Îß§ÏàòÌò∏Í∞Ä - Red) -->
                    <div id="trade_bids" class="space-y-0.5">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Order Input -->
                <div class="bg-white/5 rounded-xl p-3 space-y-3">
                    <!-- Order Type Toggle -->
                    <div class="flex h-8 bg-black/40 rounded-lg p-0.5">
                        <button class="flex-1 rounded text-[9px] font-bold bg-primary text-background-dark">ÏßÄÏ†ïÍ∞Ä</button>
                        <button class="flex-1 rounded text-[9px] font-bold text-white/40">ÏãúÏû•Í∞Ä</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="space-y-1">
                            <label class="text-[8px] text-white/40 uppercase font-bold">Price</label>
                            <input type="number" id="trade_price"
                                class="w-full bg-black/40 border border-white/10 rounded-lg text-xs text-primary px-2 py-1.5"
                                value="852.40">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[8px] text-white/40 uppercase font-bold">Qty</label>
                            <input type="number" id="trade_qty"
                                class="w-full bg-black/40 border border-white/10 rounded-lg text-xs text-white px-2 py-1.5"
                                value="10">
                        </div>
                    </div>
                    <!-- Quick Percentage Buttons -->
                    <div class="flex gap-1.5">
                        <button
                            class="flex-1 py-1 bg-white/5 rounded text-[8px] font-bold text-white/60 hover:bg-primary/20 transition-colors"
                            onclick="setQtyPercent(0.25)">25%</button>
                        <button
                            class="flex-1 py-1 bg-white/5 rounded text-[8px] font-bold text-white/60 hover:bg-primary/20 transition-colors"
                            onclick="setQtyPercent(0.5)">50%</button>
                        <button
                            class="flex-1 py-1 bg-white/5 rounded text-[8px] font-bold text-white/60 hover:bg-primary/20 transition-colors"
                            onclick="setQtyPercent(1.0)">MAX</button>
                    </div>
                    <div class="flex gap-2">
                        <button
                            class="flex-1 h-12 bg-trading-blue rounded-lg font-black text-sm shadow-[0_4px_15px_rgba(59,130,246,0.3)] active:scale-95 transition-transform"
                            onclick="placeOrder('SELL')">SELL</button>
                        <button
                            class="flex-1 h-12 bg-trading-red rounded-lg font-black text-sm shadow-[0_4px_15px_rgba(244,63,94,0.3)] active:scale-95 transition-transform"
                            onclick="placeOrder('BUY')">BUY</button>
                    </div>
                </div>
            </section>

            <!-- Tab: PORTFOLIO ( ÏûîÍ≥† ) -->
            <section id="tab-portfolio" class="tab-content p-4 space-y-6">
                <!-- Real Engine (KIS) -->
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <h3 class="text-[10px] font-bold text-white/40 tracking-widest uppercase">Engine 1: Real
                            Positions</h3>
                        <span class="text-[8px] bg-white/5 text-white/40 px-2 py-0.5 rounded">MONITOR ONLY</span>
                    </div>
                    <div id="port_real_list" class="grid grid-cols-1 gap-2">
                        <!-- Real Position Cards -->
                    </div>
                </div>

                <!-- Mock Engine (KIS) -->
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <h3 class="text-[10px] font-bold text-success tracking-widest uppercase">Engine 3: Mock
                            Investment</h3>
                        <span class="text-[8px] bg-success/10 text-success px-2 py-0.5 rounded italic">AGGRESSIVE
                            TRADING</span>
                    </div>
                    <div id="port_mock_list" class="grid grid-cols-1 gap-2">
                        <!-- Mock Position Cards -->
                    </div>
                </div>

                <!-- Virtual Engine (Sim) -->
                <div class="space-y-3 opacity-60">
                    <h3 class="text-[10px] font-bold text-primary/60 tracking-widest uppercase">Engine 2: Virtual
                        Simulation</h3>
                    <div id="port_virtual_list" class="grid grid-cols-1 gap-2">
                        <!-- Virtual Position Cards -->
                    </div>
                </div>
            </section>

            <!-- Tab: HISTORY ( ÎÇ¥Ïó≠ ) - New section added to layout -->
            <section id="tab-history" class="tab-content p-4 space-y-4">
                <div class="flex items-center justify-between sticky top-[92px] bg-background-dark z-40 py-2">
                    <h2 class="text-sm font-bold tracking-widest uppercase">Trade History</h2>
                    <div class="flex bg-white/5 rounded-lg p-1" id="history_filter">
                        <button onclick="filterHistory('all')"
                            class="px-3 py-1 bg-primary text-background-dark text-[8px] font-bold rounded">ALL</button>
                        <button onclick="filterHistory('real')"
                            class="px-3 py-1 text-white/40 text-[8px] font-bold rounded">REAL</button>
                        <button onclick="filterHistory('mock')"
                            class="px-3 py-1 text-white/40 text-[8px] font-bold rounded">MOCK</button>
                        <button onclick="filterHistory('sim')"
                            class="px-3 py-1 text-white/40 text-[8px] font-bold rounded">SIM</button>
                    </div>
                </div>
                <div id="history_list" class="space-y-2">
                    <!-- Trade history items -->
                    <div class="text-white/20 italic text-center py-8">Fetching execution logs...</div>
                </div>
            </section>

            <!-- Tab: SIGNALS ( Ìï©Ïπò ) -->
            <section id="tab-signals" class="tab-content p-4 space-y-6">
                <!-- Savage Validator Section -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-bold tracking-widest uppercase flex items-center gap-2">
                            <span class="material-symbols-outlined text-base text-danger">shield_with_heart</span>
                            Savage Validator
                        </h3>
                        <button id="validate_btn" onclick="runSavageValidation()"
                            class="px-3 py-1.5 bg-danger/20 border border-danger/30 text-danger rounded-lg text-[9px] font-bold hover:bg-danger hover:text-white transition-colors">
                            RUN VALIDATION
                        </button>
                    </div>

                    <!-- Validation Result Card -->
                    <div id="validation_result" class="glass-card rounded-2xl p-5 space-y-4 hidden">
                        <!-- Confidence Meter -->
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-[9px] text-white/40 font-bold uppercase">Validation Confidence</p>
                                <p id="val_confidence" class="text-2xl font-black text-white">0%</p>
                            </div>
                            <div id="val_status_badge"
                                class="px-3 py-1 rounded-full bg-danger/20 border border-danger/30 text-danger text-[9px] font-bold uppercase">
                                FAILED
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="h-2 bg-white/5 rounded-full overflow-hidden">
                            <div id="val_progress" class="h-full bg-danger transition-all duration-1000"
                                style="width: 0%"></div>
                        </div>

                        <!-- Savage Comment Box -->
                        <div class="bg-black/60 border border-danger/20 rounded-xl p-4">
                            <p class="text-[9px] text-white/30 font-bold uppercase mb-2">üíÄ Reality Check</p>
                            <p id="val_savage_comment" class="text-[10px] text-white/80 leading-relaxed font-mono">
                                Í≤ÄÏ¶ùÏùÑ Ïã§ÌñâÌïòÎ©¥ ÎÉâÏÜåÏ†ÅÏù∏ ÏΩîÎ©òÌä∏Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§...
                            </p>
                        </div>

                        <!-- Validation Checks -->
                        <div class="space-y-2">
                            <p class="text-[9px] text-white/40 font-bold uppercase">Detailed Checks</p>
                            <div id="val_checks" class="space-y-1 text-[10px] font-mono">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Original Confluence Section -->
                <div class="flex flex-col items-center py-8">
                    <div class="relative w-40 h-40 flex items-center justify-center">
                        <svg class="absolute inset-0 w-full h-full -rotate-90">
                            <circle cx="80" cy="80" r="70" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="8">
                            </circle>
                            <circle id="confluence_circle" cx="80" cy="80" r="70" fill="none" stroke="#25e2f4"
                                stroke-width="8" stroke-dasharray="440" stroke-dashoffset="100"
                                class="transition-all duration-1000"></circle>
                        </svg>
                        <div class="text-center">
                            <p id="confluence_score" class="text-4xl font-black text-white">88%</p>
                            <p class="text-[9px] text-primary font-bold uppercase tracking-widest">Confluence</p>
                        </div>
                    </div>
                    <div
                        class="mt-6 px-4 py-1.5 rounded-full bg-success/20 border border-success/30 text-success text-[10px] font-bold uppercase">
                        Strong Alignment Detected
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="glass-card rounded-xl p-4 space-y-2">
                        <p class="text-[9px] text-white/40 font-bold uppercase">Technical (TA)</p>
                        <div class="space-y-1">
                            <p class="text-xs font-bold">RSI (14): <span id="sig_rsi" class="text-primary">72.4</span>
                            </p>
                            <p class="text-xs font-bold">Bollinger: <span class="text-primary font-bold">Standard</span>
                            </p>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 space-y-2">
                        <p class="text-[9px] text-white/40 font-bold uppercase">AI Context</p>
                        <div class="space-y-1">
                            <p class="text-xs font-bold font-display" id="sig_sentiment">BULLISH</p>
                            <p class="text-[9px] text-white/40 leading-tight italic" id="sig_reason">"Positive earnings
                                gap predicted."</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab: STRATEGY ( Î∞∞Î∂Ñ ) -->
            <section id="tab-strategy" class="tab-content p-4 space-y-6">
                <h2 class="text-sm font-bold tracking-widest uppercase">Strategy Weight Control</h2>

                <div class="space-y-6">
                    <!-- Sniper Strat -->
                    <div class="glass-card rounded-2xl p-5 space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold text-primary">Apex Split-Sniper</h3>
                            <span id="strat_sniper_val" class="text-xl font-black text-white">65%</span>
                        </div>
                        <input type="range" class="w-full accent-primary h-2 bg-white/5 rounded-full appearance-none"
                            value="65">
                        <p class="text-[9px] text-white/30 leading-relaxed italic">High-frequency scalping logic
                            focusing on micro-volatility expansion.</p>
                    </div>

                    <!-- Fractal Strat -->
                    <div class="glass-card rounded-2xl p-5 space-y-4">
                        <div class="flex justify-between items-center text-white/50">
                            <h3 class="text-lg font-bold">Fractal Chaos</h3>
                            <span id="strat_fractal_val" class="text-xl font-black">35%</span>
                        </div>
                        <input type="range" class="w-full accent-primary/30 h-2 bg-white/5 rounded-full appearance-none"
                            value="35">
                    </div>
                </div>

                <div class="pt-6">
                    <button
                        class="w-full h-14 bg-primary text-background-dark font-black rounded-xl text-sm shadow-[0_4px_15px_rgba(37,226,244,0.3)] transition-transform active:scale-95">
                        SYNC TO ENGINE
                    </button>
                </div>
            </section>

            <!-- Tab: RISK ( Î≥¥Ïïà ) -->
            <section id="tab-risk" class="tab-content p-4 space-y-6">
                <!-- Health Stats -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="glass-card rounded-xl p-4 border-success/10">
                        <div class="flex items-center justify-between mb-1">
                            <p class="text-[9px] text-white/40 font-bold">Kiwoom API</p>
                            <div class="size-1.5 rounded-full bg-success"></div>
                        </div>
                        <p class="text-sm font-black text-white">Online (12ms)</p>
                    </div>
                    <div class="glass-card rounded-xl p-4 border-success/10">
                        <div class="flex items-center justify-between mb-1">
                            <p class="text-[9px] text-white/40 font-bold">KIS API</p>
                            <div class="size-1.5 rounded-full bg-success"></div>
                        </div>
                        <p class="text-sm font-black text-white">Online (8ms)</p>
                    </div>
                </div>

                <!-- Kelly Weight -->
                <div class="bg-primary/5 border border-primary/20 rounded-2xl p-5 flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-sm text-primary">psychology</span>
                            <h3 class="text-xs font-bold text-primary uppercase">Kelly Recommendation</h3>
                        </div>
                        <p class="text-xl font-black text-white" id="kelly_val">12.5% Position</p>
                    </div>
                    <button class="px-4 py-2 bg-primary text-background-dark text-[10px] font-bold rounded-lg"
                        onclick="applyKelly()">APPLY</button>
                </div>

                <!-- Emergency Section -->
                <div class="pt-8 space-y-3">
                    <h3 class="text-[10px] font-bold text-danger uppercase tracking-widest px-1">Danger Zone</h3>
                    <button
                        class="w-full h-16 bg-danger/10 border border-danger/30 text-danger rounded-xl font-bold flex items-center justify-center gap-3 transition-colors hover:bg-danger hover:text-white"
                        onclick="liquidateAll()">
                        <span class="material-symbols-outlined">emergency_home</span>
                        EMERGENCY KILL SWITCH
                    </button>
                    <p class="text-center text-[8px] text-white/20 italic">Liquidation of all active positions across
                        all connected exchanges.</p>
                </div>
            </section>

        </main>

        <!-- Navigation: 8-Tab Mobile Style -->
        <nav
            class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[430px] bg-background-dark/80 ios-blur border-t border-white/5 flex items-center justify-between px-2 pb-6 pt-2 z-[100] text-white/40">
            <button class="nav-btn active text-primary" onclick="switchTab('home', this)">
                <span class="material-symbols-outlined text-[20px]">meeting_room</span>
                <span class="text-[7px] font-bold">HOME</span>
            </button>
            <button class="nav-btn" onclick="switchTab('market', this)">
                <span class="material-symbols-outlined text-[20px]">radar</span>
                <span class="text-[7px] font-bold">RADAR</span>
            </button>
            <button class="nav-btn" onclick="switchTab('trade', this)">
                <span class="material-symbols-outlined text-[20px]">token</span>
                <span class="text-[7px] font-bold">TRADE</span>
            </button>
            <button class="nav-btn" onclick="switchTab('portfolio', this)">
                <span class="material-symbols-outlined text-[20px]">wallet</span>
                <span class="text-[7px] font-bold">PORT</span>
            </button>
            <button class="nav-btn" onclick="switchTab('history', this)">
                <span class="material-symbols-outlined text-[20px]">history_edu</span>
                <span class="text-[7px] font-bold">HIST</span>
            </button>
            <button class="nav-btn" onclick="switchTab('signals', this)">
                <span class="material-symbols-outlined text-[20px]">confluence</span>
                <span class="text-[7px] font-bold">SIGNAL</span>
            </button>
            <button class="nav-btn" onclick="switchTab('strategy', this)">
                <span class="material-symbols-outlined text-[20px]">tune</span>
                <span class="text-[7px] font-bold">STRAT</span>
            </button>
            <button class="nav-btn" onclick="switchTab('risk', this)">
                <span class="material-symbols-outlined text-[20px]">shield</span>
                <span class="text-[7px] font-bold">RISK</span>
            </button>
        </nav>
    </div>

    <!-- HTS Core Logic -->
    <!-- HTS Core Logic -->
    <script>
        let currentTab = 'home';
        let globalTradesData = null;

        function switchTab(tabId, btn) {
            currentTab = tabId;
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            const targetTab = document.getElementById('tab-' + tabId);
            if (targetTab) targetTab.classList.add('active');

            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('text-primary');
                b.classList.add('text-white/40');
            });
            btn.classList.add('text-primary');
            btn.classList.remove('text-white/40');

            updateServerData();
        }

        async function updateServerData() {
            try {
                // 1. Core Status
                const statusResp = await fetch('/api/status');
                const status = await statusResp.json();

                // Update Tri-Engine Balances
                if (status.balances) {
                    document.getElementById('balance_real').innerText = status.balances.real;
                    document.getElementById('balance_virtual').innerText = status.balances.virtual;
                    document.getElementById('balance_mock').innerText = status.balances.mock;
                }

                document.getElementById('equity_total').innerText = status.balance;
                document.getElementById('equity_profit').innerText = status.profit_pct;
                document.getElementById('home_tick_total').innerText = status.tick_total;
                document.getElementById('server_time').innerText = status.last_update;
                document.getElementById('engine_mode').innerText = "TRI-ENGINE v7.0";

                // 2. Panopticon Feed Update
                const panFeed = document.getElementById('panopticon_feed');
                if (status.reports && status.reports.length > 0) {
                    panFeed.innerHTML = '';
                    status.reports.reverse().forEach(rpt => {
                        let rankColor = "text-white/40";
                        if (rpt.rank === "General") rankColor = "text-trading-red font-black";
                        else if (rpt.rank === "Colonel") rankColor = "text-risk-amber font-bold";
                        else if (rpt.rank === "Private") rankColor = "text-primary/60";

                        panFeed.innerHTML += `
                            <div class="border-l-2 border-white/5 pl-2 py-1">
                                <div class="flex items-center gap-2 text-[8px] opacity-40">
                                    <span>[${rpt.timestamp}]</span>
                                    <span class="${rankColor}">${rpt.rank} ${rpt.unit}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-primary font-bold">${rpt.action}</span>
                                    <span class="text-white/60">${rpt.detail}</span>
                                </div>
                            </div>
                        `;
                    });
                }

                // 3. Radar (Interest Stocks / Í¥ÄÏã¨Ï¢ÖÎ™©)
                if (currentTab === 'home' || currentTab === 'market') {
                    const radarResp = await fetch('/api/radar');
                    const radar = await radarResp.json();
                    const combined = [...radar.kr, ...radar.us];

                    const container = currentTab === 'home' ? document.getElementById('home_radar_list') : document.getElementById('market_radar_list');
                    if (container) {
                        container.innerHTML = '';
                        combined.slice(0, currentTab === 'home' ? 5 : 100).forEach(stock => {
                            container.innerHTML += `
                                <div class="glass-card rounded-xl p-4 flex justify-between items-center cursor-pointer hover:bg-white/5 transition-colors" onclick="selectTicker('${stock.ticker}', '${stock.name}')">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center font-bold text-primary text-[8px]">${stock.ticker.slice(0, 2)}</div>
                                        <div>
                                            <p class="text-xs font-bold">${stock.name}</p>
                                            <p class="text-[8px] text-white/30">${stock.ticker}</p>
                                        </div>
                                    </div>
                                    <span class="text-xs font-bold text-primary">+${stock.change?.toFixed(2) || '0.00'}%</span>
                                </div>
                            `;
                        });
                    }
                }

                // 4. Portfolio Sync
                if (status.positions) {
                    renderPositions('port_real_list', status.positions.real, 'real');
                    renderPositions('port_virtual_list', status.positions.virtual, 'sim');
                    renderPositions('port_mock_list', status.positions.mock, 'mock');
                }

                // 5. Trade History Sync
                if (status.trades) {
                    globalTradesData = status.trades;
                    if (currentTab === 'history') {
                        filterHistory(document.querySelector('.history-filter-active')?.dataset.type || 'all');
                    }
                }

                // 6. Signals Sync
                const sigResp = await fetch('/api/signals');
                const sig = await sigResp.json();
                const confCircle = document.getElementById('confluence_circle');
                if (confCircle) {
                    document.getElementById('confluence_score').innerText = sig.confluence + '%';
                    confCircle.style.strokeDashoffset = 440 - (440 * sig.confluence / 100);
                }
                const sigRsi = document.getElementById('sig_rsi');
                if (sigRsi) sigRsi.innerText = sig.ta.rsi;
                const sigSent = document.getElementById('sig_sentiment');
                if (sigSent) sigSent.innerText = sig.ai.sentiment;

            } catch (e) {
                console.warn("Update Error:", e);
            }
        }

        function renderPositions(id, posList, type) {
            const container = document.getElementById(id);
            if (!container) return;
            container.innerHTML = '';

            const posArray = Array.isArray(posList) ? posList : Object.values(posList);

            if (posArray.length === 0) {
                container.innerHTML = `<div class="bg-white/5 rounded-xl p-4 text-center text-[9px] text-white/20 italic">No active positions.</div>`;
                return;
            }

            posArray.forEach(pos => {
                const profit = pos.profit || 0;
                const profitPct = pos.profit_pct || 0;
                const profitColor = profit >= 0 ? 'text-trading-red' : 'text-trading-blue';
                const sign = profit >= 0 ? '+' : '';
                container.innerHTML += `
                    <div class="glass-card rounded-xl p-3 flex justify-between items-center mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center font-bold text-primary text-[8px]">${pos.ticker.slice(0, 2)}</div>
                            <div>
                                <p class="text-xs font-bold">${pos.name || pos.ticker}</p>
                                <p class="text-[8px] text-white/30">${pos.qty}Ï£º @ ${pos.avg_price.toLocaleString()}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-xs font-bold ${profitColor}">${sign}${profit.toLocaleString()}</p>
                            <p class="text-[8px] ${profitColor} font-bold">${profitPct}%</p>
                        </div>
                    </div>
                `;
            });
        }

        function filterHistory(type) {
            const container = document.getElementById('history_list');
            if (!container || !globalTradesData) return;

            document.querySelectorAll('#history_filter button').forEach(b => {
                b.classList.remove('bg-primary', 'text-background-dark', 'history-filter-active');
                b.classList.add('text-white/40');
                if (b.innerText.toLowerCase() === type.toLowerCase() || (type === 'all' && b.innerText === 'ALL')) {
                    b.classList.add('bg-primary', 'text-background-dark', 'history-filter-active');
                    b.classList.remove('text-white/40');
                }
            });

            container.innerHTML = '';
            const allTrades = [
                ...(globalTradesData.real || []).map(t => ({ ...t, engine: 'real' })),
                ...(globalTradesData.virtual || []).map(t => ({ ...t, engine: 'sim' })),
                ...(globalTradesData.mock || []).map(t => ({ ...t, engine: 'mock' }))
            ].sort((a, b) => (b.timestamp || b.time || "").localeCompare(a.timestamp || a.time || ""));

            const filtered = type === 'all' ? allTrades : allTrades.filter(t => t.engine === type);

            if (filtered.length === 0) {
                container.innerHTML = `<div class="text-white/20 italic text-center py-8">Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>`;
                return;
            }

            filtered.forEach(t => {
                const typeStyle = t.engine === 'real' ? 'bg-white/10 text-white/60' : (t.engine === 'mock' ? 'bg-success/20 text-success' : 'bg-primary/20 text-primary');
                container.innerHTML += `
                    <div class="glass-card rounded-xl p-3 flex justify-between items-center mb-2">
                        <div class="flex items-center gap-3">
                            <span class="text-[7px] font-black px-1.5 py-0.5 rounded ${typeStyle}">${t.engine.toUpperCase()}</span>
                            <div>
                                <p class="text-xs font-bold">${t.name || t.ticker}</p>
                                <p class="text-[8px] text-white/40">${t.timestamp || t.time || 'N/A'} | ${t.qty}Ï£º @ ${t.price.toLocaleString()}</p>
                            </div>
                        </div>
                        <span class="text-[10px] font-black ${t.action === 'Îß§Ïàò' || t.action === 'BUY' ? 'text-trading-red' : 'text-trading-blue'}">${t.action}</span>
                    </div>
                `;
            });
        }

        function selectTicker(ticker, name) {
            const tradeTitle = document.querySelector('#tab-trade h2');
            const tradeSubtitle = document.querySelector('#tab-trade p');
            if (tradeTitle) tradeTitle.innerText = name;
            if (tradeSubtitle) tradeSubtitle.innerText = ticker;
            switchTab('trade', document.querySelectorAll('.nav-btn')[2]);
        }

        async function placeOrder(action) {
            const ticker = document.querySelector('#tab-trade p').innerText;
            const price = parseFloat(document.getElementById('trade_price').value);
            const qty = parseInt(document.getElementById('trade_qty').value);

            const resp = await fetch('/api/order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ticker, action, price, quantity: qty, engine_type: 'mock' })
            });
            const result = await resp.json();
            alert(result.success ? "Ï£ºÎ¨∏ ÏÑ±Í≥µ!" : "Ï£ºÎ¨∏ Ïã§Ìå®: " + result.error);
            updateServerData();
        }

        setInterval(updateServerData, 3000);
        updateServerData();
    </script>
</body>

</html>