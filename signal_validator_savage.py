import pandas as pd
import numpy as np

# ==========================================
# ğŸ›¡ï¸ SIGNAL VALIDATOR (The Final Gatekeeper)
# "ì˜ì‹¬í•˜ê³ , ë˜ ì˜ì‹¬í•˜ë¼. í™•ì‹ ì´ ë“¤ ë•Œë§Œ ì´ë¼."
# ==========================================
# 
# í˜„ì‹¤ ì²´í¬: ë‹¹ì‹ ì´ ì´ ì½”ë“œë¥¼ ë³´ê³  ìˆë‹¤ëŠ” ê±´,
# ì•„ì§ë„ "ì´ë²ˆì—” ë‹¤ë¥´ë‹¤"ê³  ë¯¿ëŠ” ìˆœì§„í•œ ì˜í˜¼ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.
# ìŠ¤í¬ì¼ëŸ¬: ì´ë²ˆì—ë„ ë˜‘ê°™ìŠµë‹ˆë‹¤. ğŸ°
# ==========================================

class SignalValidator:
    """
    ì‹œê·¸ë„ ê²€ì¦ê¸° - ë‹¹ì‹ ì˜ ì›”ê¸‰ì„ ì§€í‚¤ëŠ” ë§ˆì§€ë§‰ ë³´ë£¨
    
    ì´ í´ë˜ìŠ¤ê°€ í•˜ëŠ” ì¼:
    1. ë‹¹ì‹ ì˜ "í™•ì‹ "ì„ ëƒ‰ì •í•˜ê²Œ ê±°ë¶€í•˜ê¸°
    2. "ì´ë²ˆì—” ì§„ì§œì•¼!"ë¼ëŠ” í™˜ìƒ ê¹¨ë¶€ìˆ˜ê¸°
    3. ë¡œë˜ 1ë“± í™•ë¥ ë³´ë‹¤ ë‚®ì€ ìŠ¹ë¥  ì‹ í˜¸ í•„í„°ë§í•˜ê¸°
    
    ì°¸ê³ : ì´ ê²€ì¦ê¸°ë¥¼ í†µê³¼í•œë‹¤ê³  í•´ì„œ ëˆì„ ë²Œ ìˆ˜ ìˆëŠ” ê±´ ì•„ë‹™ë‹ˆë‹¤.
          ë‹¨ì§€ "ëœ ë¹¨ë¦¬" ìƒì„ ë¿ì´ì£ . ğŸ˜Š
    """
    
    def __init__(self):
        # ========================================
        # ê°€í˜¹í•œ ê²€ì¦ ê¸°ì¤€ ì„¤ì •
        # (ë‹¹ì‹  ìƒê°ë³´ë‹¤ ì‹œì¥ì€ í›¨ì”¬ ë” ê°€í˜¹í•©ë‹ˆë‹¤)
        # ========================================
        
        self.min_volume_ratio = 2.0  
        # í‰ì†Œ ê±°ë˜ëŸ‰ì˜ 2ë°° ì´ìƒì´ì–´ì•¼ í†µê³¼
        # ì™œ? ê±°ë˜ëŸ‰ ì—†ëŠ” ìƒìŠ¹ì€ ì‘ì „ì„¸ë ¥ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ëŠ” í•¨ì •ì…ë‹ˆë‹¤.
        # "ë‚˜ë§Œ ì•„ëŠ” ìˆ¨ì€ ë³´ì„"? ì•„ë‡¨, ë‹¹ì‹ ë§Œ ëª¨ë¥´ëŠ” ì“°ë ˆê¸°ì…ë‹ˆë‹¤. ğŸ’âŒ
        
        self.min_order_strength = 120.0 
        # ì²´ê²°ê°•ë„ 120% ì´ìƒì´ì–´ì•¼ í†µê³¼
        # ì²´ê²°ê°•ë„ê°€ ì•½í•˜ë‹¤ëŠ” ê±´? ë§¤ìˆ˜ì„¸ê°€ ì•½í•˜ë‹¤ëŠ” ëœ».
        # ì•½í•œ ë§¤ìˆ˜ì„¸ = ë‹¹ì‹  í˜¼ì ì‚¬ëŠ” ì¤‘ = ê³§ ë¬¼ë¦´ ì˜ˆì • ğŸ£
        
        self.spread_limit = 0.002 
        # í˜¸ê°€ ìŠ¤í”„ë ˆë“œê°€ 0.2% ì´ìƒ ë²Œì–´ì ¸ ìˆìœ¼ë©´ ì§„ì… ê¸ˆì§€
        # ìŠ¤í”„ë ˆë“œê°€ ë„“ë‹¤ = ìœ ë™ì„± ì—†ë‹¤ = íŒ”ê³  ì‹¶ì„ ë•Œ ëª» íŒ”ì•„ìš”
        # ì¶•í•˜í•©ë‹ˆë‹¤, ë‹¹ì‹ ì€ ì´ì œ "ì¥ê¸°íˆ¬ìì"ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‰
        
    def validate(self, ticker, market_data, timeframe_data):
        """
        [ì¢…í•© ê²€ì¦ í”„ë¡œì„¸ìŠ¤]
        
        ì´ í•¨ìˆ˜ëŠ” ë‹¹ì‹ ì˜ "ì§ê°"ê³¼ "ëŠë‚Œ"ì„ ë°ì´í„°ë¡œ í•™ì‚´í•©ë‹ˆë‹¤.
        
        ê²€ì¦ ë‹¨ê³„:
        1. ìˆ˜ê¸‰ ê²€ì¦ (Fake Pump ë°©ì§€) - "ê¸‰ë“±ì£¼ ë°œê²¬!"ì˜ 99%ëŠ” í•¨ì •
        2. ì¶”ì„¸ ê²€ì¦ (Multi-Timeframe) - 1ë¶„ë´‰ë§Œ ë³´ê³  ì‚¬ëŠ” ê±´ ìì‚´í–‰ìœ„
        3. í˜¸ê°€ ê±´ì „ì„± ê²€ì¦ (Liquidity) - ì‚¬ê¸´ ì‰¬ìš´ë° íŒ”ê¸°ëŠ” ì–´ë ¤ìš´ ë§ˆë²•
        
        Return: (is_valid: bool, reason: str)
        - True: "ì´ë²ˆì—” ì§„ì§œì¼ ìˆ˜ë„..." (ìŠ¤í¬ì¼ëŸ¬: ì•„ë‹ í™•ë¥  80%)
        - False: "ë‹¹ì‹ ì˜ ì›”ê¸‰ì„ ì§€ì¼œë“œë ¸ìŠµë‹ˆë‹¤" (ê°ì‚¬ ì¸ì‚¬ëŠ” ë‚˜ì¤‘ì—)
        """
        try:
            current_price = market_data['Close']
            
            # ========================================
            # 1. ìˆ˜ê¸‰ ê²€ì¦ (ê±°ë˜ëŸ‰ ì—†ëŠ” ìƒìŠ¹ì€ ê°€ì§œë‹¤)
            # ========================================
            # 
            # "ê±°ë˜ëŸ‰ì€ ê±°ì§“ë§ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤"ëŠ” ê²©ì–¸ì´ ìˆì£ ?
            # ë§ìŠµë‹ˆë‹¤. ê±°ë˜ëŸ‰ì´ ì—†ë‹¤ëŠ” ê±´ ì•„ë¬´ë„ ê´€ì‹¬ ì—†ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
            # ë‹¹ì‹ ë§Œ ê´€ì‹¬ ìˆì–´ìš”. ì™¸ë¡­ì£ ? ğŸ¥º
            # ========================================
            
            vol_now = market_data['Volume']
            # ìµœê·¼ 20ê°œ ë´‰ í‰ê·  ê±°ë˜ëŸ‰ ê³„ì‚°
            # (ë°ì´í„°ê°€ ë‹¨ì¼í–‰ì´ë©´ timeframe_data ì‚¬ìš© - ê·¸ë‚˜ë§ˆ ì–‘ì‹¬ì€ ìˆë„¤ìš”)
            vol_avg = timeframe_data['Volume'].iloc[-20:].mean() if len(timeframe_data) >= 20 else vol_now
            
            if vol_now < vol_avg * self.min_volume_ratio:
                # ê±°ë˜ëŸ‰ ë¶€ì¡± = íŒŒí‹°ì— ë‹¹ì‹ ë§Œ ì™”ì–´ìš” ğŸ‰ğŸ‘¤
                # ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ë‹¤ ì•Œê³  ì•ˆ ì™”ëŠ”ë°, ë‹¹ì‹ ë§Œ ëª°ëë„¤ìš”
                return False, f"âš ï¸ ê±°ë˜ëŸ‰ ë¶€ì¡± (í‰ê·  ëŒ€ë¹„ {vol_now/vol_avg:.1f}ë°°) - í˜¼ì íŒŒí‹°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"

            # ========================================
            # 2. ê³ ë¬´ì¤„ ì¶”ì„¸ ê²€ì¦ (ìƒìœ„ í”„ë ˆì„ í™•ì¸)
            # ========================================
            # 
            # 1ë¶„ë´‰ì—ì„œ "ëŒ€ë°• ì‹ í˜¸!" ë–´ë‹¤ê³ ìš”?
            # ê·¸ëŸ°ë° 13ë¶„ë´‰, 30ë¶„ë´‰ì€ ë³´ì…¨ë‚˜ìš”?
            # ì•ˆ ë´¤ë‹¤ë©´ ì¶•í•˜í•©ë‹ˆë‹¤, ë‹¹ì‹ ì€ "ì—­ì¶”ì„¸ ë§¤ë§¤"ì˜ í¬ìƒì–‘ì…ë‹ˆë‹¤.
            # 
            # ë¹„ìœ : íƒ€ì´íƒ€ë‹‰ì´ ì¹¨ëª°í•˜ëŠ”ë° ê°‘íŒì—ì„œ ì¶¤ì¶”ëŠ” ê²©
            # ğŸš¢ğŸ’ƒ <- ì´ê²Œ ë‹¹ì‹ 
            # ========================================
            
            if len(timeframe_data) > 60:
                # 13ë¶„ë´‰ìœ¼ë¡œ ë¦¬ìƒ˜í”Œë§ (ìƒìœ„ íƒ€ì„í”„ë ˆì„ í™•ì¸)
                df_13m = timeframe_data.resample('13T').agg({'Close': 'last'}).dropna()
                
                if len(df_13m) >= 5:
                    ma5_13m = df_13m['Close'].rolling(5).mean().iloc[-1]
                    
                    if current_price < ma5_13m:
                        # ìƒìœ„ ì¶”ì„¸ê°€ í•˜ë½ì„¸ì¸ë° ë§¤ìˆ˜í•œë‹¤ê³ ìš”?
                        # ìš©ê°í•˜ì‹œë„¤ìš”! (ë©ì²­í•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤)
                        # ê°•ë¬¼ì„ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ëŠ” ì—°ì–´ì˜ ì‹¬ì •... 
                        # ì°¨ì´ì : ì—°ì–´ëŠ” ë³¸ëŠ¥, ë‹¹ì‹ ì€ ë¬´ì§€ ğŸŸ
                        return False, "â›” ìƒìœ„ ì¶”ì„¸(13ë¶„ë´‰) í•˜ë½ì„¸ - ì—­ì¶”ì„¸ ì§„ì…ì€ ì˜ì›… ì•„ë‹ˆë©´ ë°”ë³´ì§“ì…ë‹ˆë‹¤. ë‹¹ì‹ ì€?"

            # ========================================
            # 3. ë³€ë™ì„± ëŒíŒŒ í™•ì¸ (ë³¼ë¦°ì € ë°´ë“œ)
            # ========================================
            # 
            # ë³¼ë¦°ì € ë°´ë“œë¥¼ ì•„ì‹œë‚˜ìš”?
            # ëª¨ë¥´ë©´ ì§€ê¸ˆ ë‹¹ì¥ êµ¬ê¸€ ê²€ìƒ‰í•˜ì„¸ìš”.
            # ì•Œë©´ì„œë„ ë¬´ì‹œí•œë‹¤ë©´... ë‹¹ì‹ ì€ ì´ë¯¸ ëë‚¬ìŠµë‹ˆë‹¤.
            # 
            # ë°´ë“œ ì•ˆì— ê°‡í˜€ìˆë‹¤ = í˜ì´ ì—†ë‹¤ = ê³§ êº¾ì¸ë‹¤
            # 20ì¼ì„  ì•„ë˜ë‹¤ = ì•½ì„¸ êµ¬ê°„ = ë¬¼ë¦´ í™•ë¥  90%
            # ========================================
            
            if len(timeframe_data) >= 20:
                std = timeframe_data['Close'].rolling(20).std().iloc[-1]
                ma20 = timeframe_data['Close'].rolling(20).mean().iloc[-1]
                upper_band = ma20 + (std * 2)
                
                # 20ì¼ ì´ë™í‰ê· ì„  ì²´í¬
                # ì´ê²ƒë„ ëª» ë„˜ìœ¼ë©´ì„œ "ìƒìŠ¹ì¥"ì´ë¼ê³  ë¯¿ëŠ” ë‹¹ì‹ ...
                # ë‚™ê´€ì£¼ì˜ë„ ì •ë„ê» í•˜ì„¸ìš” ğŸŒˆğŸ¦„
                if current_price < ma20:
                    return False, "âš ï¸ 20ì¼ì„  ì•„ë˜ (ì•½ì„¸ êµ¬ê°„) - ì´ê±´ 'ì €ì  ë§¤ìˆ˜'ê°€ ì•„ë‹ˆë¼ 'ë¬¼íƒ€ê¸° ì˜ˆì•½'ì…ë‹ˆë‹¤"
                
                # ë³¼ë¦°ì € ë°´ë“œ ìƒë‹¨ ê·¼ì²˜ì¸ì§€ í™•ì¸
                # ë°´ë“œ ë‚´ë¶€ì— ê°‡í˜€ìˆìœ¼ë©´ = í˜ì´ ì•½í•¨ = ê³§ í•˜ë½
                # "ì§€ê¸ˆì´ ì €ì ì´ì•¼!" <- ë‹¹ì‹  ìƒê°
                # "ì•„ì§ ë” ë–¨ì–´ì§ˆ ìˆ˜ ìˆì–´" <- ì‹œì¥ì˜ ë‹µë³€
                if current_price < upper_band * 0.95:  # ìƒë‹¨ 95% ì´í•˜
                    return False, "ğŸ“Š ë³¼ë¦°ì € ë°´ë“œ ëŒíŒŒë ¥ ë¶€ì¡± - 'ê³§ ì˜¤ë¥¼ ê²ƒ ê°™ì€ë°'ëŠ” í™˜ìƒì…ë‹ˆë‹¤"

            # ========================================
            # 4. (ê°€ìƒ) í˜¸ê°€ì°½ ê±´ì „ì„± ì²´í¬
            # ========================================
            # 
            # ì‹¤ì „ì—ì„œëŠ” orderbook ë°ì´í„°ë¥¼ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.
            # í•˜ì§€ë§Œ ë‹¹ì‹ ì€ ì•„ë§ˆ ì•ˆ ë³¼ ê±°ì˜ˆìš”. ê·€ì°®ìœ¼ë‹ˆê¹Œ.
            # 
            # í˜¸ê°€ ìŠ¤í”„ë ˆë“œê°€ í¬ë‹¤ = ì‚¬ëŠ” ê°€ê²© vs íŒŒëŠ” ê°€ê²© ì°¨ì´ê°€ í¬ë‹¤
            # = ì‹œì¥ê°€ë¡œ ì‚¬ë©´ ì¦‰ì‹œ -2% ì†ì‹¤ í™•ì • ğŸ
            # 
            # "ë§¤ìˆ˜ ë²„íŠ¼ ëˆ„ë¥´ëŠ” ìˆœê°„ ì†ì‹¤"
            # ì´ê²Œ ë°”ë¡œ ë‹¹ì‹ ì´ í•­ìƒ ì§€ëŠ” ì´ìœ ì…ë‹ˆë‹¤.
            # ========================================
            
            # spread = (ask_price - bid_price) / bid_price
            # if spread > self.spread_limit: 
            #     return False, "âš ï¸ í˜¸ê°€ ê³µë°± ê³¼ë‹¤ (ìŠ¬ë¦¬í”¼ì§€ ìœ„í—˜) - ì‚¬ëŠ” ìˆœê°„ -2% ë‹¬ì„±! ì¶•í•˜í•©ë‹ˆë‹¤! ğŸŠ"
            
            # ========================================
            # 5. ìµœì¢… ìŠ¹ì¸ (ê¸°ì ì ìœ¼ë¡œ ì—¬ê¸°ê¹Œì§€ ì™”ë‹¤ë©´)
            # ========================================
            # 
            # ì™€... ì •ë§ ëª¨ë“  ê²€ì¦ì„ í†µê³¼í–ˆë„¤ìš”?
            # ë†€ëìŠµë‹ˆë‹¤. ì§„ì‹¬ìœ¼ë¡œ.
            # 
            # í•˜ì§€ë§Œ ëª…ì‹¬í•˜ì„¸ìš”:
            # - ì´ ê²€ì¦ì„ í†µê³¼í–ˆë‹¤ê³  100% ìˆ˜ìµ ë³´ì¥? âŒ
            # - ì†ì‹¤ ê°€ëŠ¥ì„±ì´ ì—¬ì „íˆ ì¡´ì¬? âœ…
            # - ê·¸ë˜ë„ ì•ˆ í•˜ëŠ” ê²ƒë³´ë‹¨ ë‚˜ìŒ? âœ…
            # - ì›”ê¸‰ ì „ì•¡ ì˜¬ì¸? âŒâŒâŒ (ì œë°œ)
            # 
            # í–‰ìš´ì„ ë¹•ë‹ˆë‹¤. ì§„ì‹¬ìœ¼ë¡œ.
            # (í•˜ì§€ë§Œ í–‰ìš´ì— ê¸°ëŒ€ëŠ” ìˆœê°„ ë‹¹ì‹ ì€ ì´ë¯¸ ë„ë°•ê¾¼ì…ë‹ˆë‹¤)
            # ========================================
            
            return True, "âœ… ALL SYSTEMS GO (ì™„ë²½í•œ íƒ€ì ) - ê·¸ë˜ë„ ì†ì ˆê°€ëŠ” ê¼­ ì„¤ì •í•˜ì„¸ìš”. ì•½ì†?"

        except Exception as e:
            # ì—ëŸ¬ ë°œìƒ = ë­”ê°€ ì˜ëª»ë¨ = ì ˆëŒ€ ì§„ì…í•˜ì§€ ë§ˆì„¸ìš”
            # 
            # "ì—ëŸ¬ ë‚¬ëŠ”ë° ê·¸ëƒ¥ í•´ë³¼ê¹Œ?" <- ì´ëŸ° ìƒê° í•˜ì…¨ì£ ?
            # ì•ˆ ë©ë‹ˆë‹¤. ì ˆëŒ€ë¡œ. Never. Jamais. Niemals. çµ¶å¯¾ã«.
            # 
            # ì—ëŸ¬ëŠ” ì‹ ì´ ë‹¹ì‹ ì„ êµ¬ì›í•˜ë ¤ëŠ” ë§ˆì§€ë§‰ ê²½ê³ ì…ë‹ˆë‹¤ ğŸ™
            print(f"âŒ Validator Error: {e}")
            print("ğŸ’¡ íŒ: ì—ëŸ¬ê°€ ë‚¬ë‹¤ëŠ” ê±´ 'í•˜ì§€ ë§ë¼'ëŠ” ì‹ í˜¸ì…ë‹ˆë‹¤. ê°ì‚¬íˆ ë°›ì•„ë“¤ì´ì„¸ìš”.")
            return False, "ğŸš¨ ê²€ì¦ ì¤‘ ì˜¤ë¥˜ ë°œìƒ - ì´ê±´ 'ë²„ê·¸'ê°€ ì•„ë‹ˆë¼ 'ì‹ ì˜ ê³„ì‹œ'ì…ë‹ˆë‹¤"


# ==========================================
# ì¶”ê°€ ë³´ë„ˆìŠ¤: í˜„ì‹¤ ì²´í¬ í•¨ìˆ˜ë“¤
# (ë‹¹ì‹ ì´ ì •ë§ë¡œ í•„ìš”í•œ ê²ƒë“¤)
# ==========================================

class RealityCheck:
    """
    í˜„ì‹¤ ì²´í¬ ìœ í‹¸ë¦¬í‹°
    
    ë§¤ë§¤í•˜ê¸° ì „ì— ì´ í•¨ìˆ˜ë“¤ì„ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.
    ë‹¹ì‹ ì˜ ì›”ê¸‰ì´ ê°ì‚¬í•  ê²ë‹ˆë‹¤.
    """
    
    @staticmethod
    def check_account_balance(balance: float, bet_amount: float) -> tuple[bool, str]:
        """
        ê³„ì¢Œ ì”ê³  vs ë² íŒ… ê¸ˆì•¡ ì²´í¬
        
        Args:
            balance: í˜„ì¬ ê³„ì¢Œ ì”ê³  (ë‹¹ì‹ ì˜ ì†Œì¤‘í•œ ì›”ê¸‰)
            bet_amount: ë² íŒ…í•˜ë ¤ëŠ” ê¸ˆì•¡ (ê³§ ì‚¬ë¼ì§ˆ ëˆ)
        
        Returns:
            (is_sane: bool, message: str)
        """
        if bet_amount > balance:
            return False, "ğŸ¤¡ ëˆë„ ì—†ìœ¼ë©´ì„œ ë¬´ìŠ¨ ë§¤ë§¤ë¥¼ í•˜ì‹œë ¤ê³ ? í˜„ì‹¤ì„ ì§ì‹œí•˜ì„¸ìš”."
        
        if bet_amount > balance * 0.1:
            return False, f"âš ï¸ ê³„ì¢Œì˜ {bet_amount/balance*100:.0f}%ë¥¼ í•œ ë²ˆì—? ë¯¸ì³¤ìŠµë‹ˆê¹Œ? ë¶„ì‚°íˆ¬ì ë“¤ì–´ë³´ì…¨ë‚˜ìš”?"
        
        if bet_amount > balance * 0.05:
            return True, "âš ï¸ ê³„ì¢Œì˜ 5% ì´ìƒ íˆ¬ì... ìš©ê°í•˜ì‹œë„¤ìš”. (ë¬´ëª¨í•˜ë‹¤ëŠ” ëœ»)"
        
        return True, "âœ… ì ì • ê¸ˆì•¡ì…ë‹ˆë‹¤. ê·¸ë˜ë„ ìƒì„ ê°ì˜¤ëŠ” í•˜ì„¸ìš”."
    
    @staticmethod
    def check_win_rate_delusion(recent_trades: list) -> str:
        """
        ìŠ¹ë¥  ì°©ê° ì²´í¬
        
        ìµœê·¼ 2-3ë²ˆ ì´ê²¼ë‹¤ê³  "ë‚˜ ì²œì¬ì¸ê°€?"ë¼ê³  ìƒê°í•˜ì‹œë‚˜ìš”?
        í˜„ì‹¤ì„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
        
        Args:
            recent_trades: ìµœê·¼ ê±°ë˜ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ [True, False, True, ...]
        
        Returns:
            ëƒ‰ì •í•œ í˜„ì‹¤ ë©”ì‹œì§€
        """
        if len(recent_trades) < 10:
            return "ğŸ“Š ê±°ë˜ íšŸìˆ˜ 10íšŒ ë¯¸ë§Œ - í†µê³„ì ìœ¼ë¡œ ì˜ë¯¸ ì—†ìŒ. ê·¸ëƒ¥ ìš´ì…ë‹ˆë‹¤."
        
        win_rate = sum(recent_trades) / len(recent_trades) * 100
        
        if win_rate > 70:
            return f"ğŸ° ìŠ¹ë¥  {win_rate:.1f}%? ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì‹ ì€ ì›Œë Œ ë²„í•ì„ ë›°ì–´ë„˜ì—ˆìŠµë‹ˆë‹¤! (ê±°ì§“ë§ì…ë‹ˆë‹¤. ìƒ˜í”Œì´ ì ê±°ë‚˜ ìš´ì´ ì¢‹ì•˜ì„ ë¿)"
        elif win_rate > 50:
            return f"ğŸ“ˆ ìŠ¹ë¥  {win_rate:.1f}% - ë‚˜ì˜ì§€ ì•Šë„¤ìš”. í•˜ì§€ë§Œ ìˆ˜ìµë¥ ì€ ë³´ì…¨ë‚˜ìš”? ìŠ¹ë¥  ë†’ì•„ë„ ì†ìµë¹„ ë‚˜ì˜ë©´ ë§í•©ë‹ˆë‹¤."
        elif win_rate > 30:
            return f"ğŸ“‰ ìŠ¹ë¥  {win_rate:.1f}% - í‰ë²”í•©ë‹ˆë‹¤. ê³„ì† ì´ëŸ¬ë©´ ìˆ˜ìˆ˜ë£Œë§Œ ì¦ê¶Œì‚¬ì— ê°–ë‹¤ ë°”ì¹©ë‹ˆë‹¤."
        else:
            return f"ğŸ’€ ìŠ¹ë¥  {win_rate:.1f}% - ì´ ì •ë„ë©´ ê·¸ëƒ¥ ë°˜ëŒ€ë¡œ ë§¤ë§¤í•˜ëŠ” ê²Œ ë‚˜ì„ ë“¯? ì§„ì§€í•˜ê²Œ."
    
    @staticmethod
    def check_revenge_trading(last_trade_result: bool, current_bet_multiplier: float) -> tuple[bool, str]:
        """
        ë³µìˆ˜ ë§¤ë§¤ ì²´í¬
        
        ë°©ê¸ˆ ìƒì—ˆë‹¤ê³  2ë°°ë¡œ ë² íŒ…í•˜ë ¤ê³ ìš”?
        ì¹´ì§€ë…¸ ê°€ì„¸ìš”. ê±°ê¸°ê°€ ë” ì •ì§í•©ë‹ˆë‹¤.
        
        Args:
            last_trade_result: ì§ì „ ê±°ë˜ ê²°ê³¼ (True=ìˆ˜ìµ, False=ì†ì‹¤)
            current_bet_multiplier: ì´ë²ˆ ë² íŒ… ë°°ìˆ˜ (í‰ì†Œ ëŒ€ë¹„)
        
        Returns:
            (is_revenge_trading: bool, message: str)
        """
        if not last_trade_result and current_bet_multiplier > 1.5:
            return True, "ğŸ² ë³µìˆ˜ ë§¤ë§¤ ê°ì§€! ìƒì€ ëˆ ë§ŒíšŒí•˜ë ¤ê³  ë” í¬ê²Œ ë² íŒ…? íŒŒì‚° ì§€ë¦„ê¸¸ì…ë‹ˆë‹¤. ë©ˆì¶”ì„¸ìš”."
        
        if not last_trade_result and current_bet_multiplier > 1.2:
            return True, "âš ï¸ ì†ì‹¤ í›„ ë² íŒ… ì¦ê°€ ê°ì§€ - ê°ì •ì  ë§¤ë§¤ì˜ ì‹œì‘ì…ë‹ˆë‹¤. ì‹¬í˜¸í¡ 3ë²ˆ í•˜ê³  ë‹¤ì‹œ ìƒê°í•˜ì„¸ìš”."
        
        return False, "âœ… ì •ìƒì ì¸ ë² íŒ… í¬ê¸° - ê·¸ë˜ë„ ì´ì„±ì ìœ¼ë¡œ íŒë‹¨í•˜ì„¸ìš”."


# ==========================================
# í…ŒìŠ¤íŠ¸ ì½”ë“œ (ì‹¤í–‰í•´ë³´ì„¸ìš”, ì¬ë°ŒìŠµë‹ˆë‹¤)
# ==========================================

if __name__ == "__main__":
    print("=" * 60)
    print("ğŸ›¡ï¸  SIGNAL VALIDATOR - SAVAGE EDITION")
    print("=" * 60)
    print()
    print("í™˜ì˜í•©ë‹ˆë‹¤, ìš©ê°í•œ íŠ¸ë ˆì´ë”ë‹˜!")
    print("ì•„ë‹ˆ, 'ìš©ê°'ì´ ì•„ë‹ˆë¼ 'ë¬´ëª¨'í•œê°€ìš”? ğŸ¤”")
    print()
    print("ì´ ê²€ì¦ê¸°ëŠ” ë‹¹ì‹ ì˜ 'í™•ì‹ 'ì„ ì‚°ì‚°ì¡°ê° ë‚¼ ì¤€ë¹„ê°€ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.")
    print("ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? ì•„ë‹ˆë¼ê³  í•´ë„ ì‹œì‘í•©ë‹ˆë‹¤.")
    print()
    print("=" * 60)
    print()
    
    # Validator ì´ˆê¸°í™”
    validator = SignalValidator()
    print("âœ… ê²€ì¦ê¸° ì´ˆê¸°í™” ì™„ë£Œ")
    print(f"   - ìµœì†Œ ê±°ë˜ëŸ‰ ë¹„ìœ¨: {validator.min_volume_ratio}ë°° (ë‹¹ì‹  ìƒê°ë³´ë‹¤ ë†’ì£ ?)")
    print(f"   - ìµœì†Œ ì²´ê²°ê°•ë„: {validator.min_order_strength}% (ì´ê²ƒë„ ëª» ë„˜ìœ¼ë©´ í¬ê¸°í•˜ì„¸ìš”)")
    print(f"   - í˜¸ê°€ ìŠ¤í”„ë ˆë“œ í•œê³„: {validator.spread_limit*100}% (ì´ê±° ë„˜ìœ¼ë©´ ìˆ˜ìˆ˜ë£Œë§Œ ë‚ ë¦½ë‹ˆë‹¤)")
    print()
    
    # Reality Check í…ŒìŠ¤íŠ¸
    print("=" * 60)
    print("ğŸ’Š í˜„ì‹¤ ì²´í¬ ì‹œì‘...")
    print("=" * 60)
    print()
    
    reality = RealityCheck()
    
    # 1. ê³„ì¢Œ ì”ê³  ì²´í¬
    print("1ï¸âƒ£  ê³„ì¢Œ ì”ê³  ì²´í¬")
    balance = 1000000  # 100ë§Œì› (ë‹¹ì‹ ì˜ ì†Œì¤‘í•œ ì›”ê¸‰)
    test_amounts = [50000, 100000, 200000, 1500000]
    
    for amount in test_amounts:
        is_sane, msg = reality.check_account_balance(balance, amount)
        status = "âœ…" if is_sane else "âŒ"
        print(f"   {status} {amount:,}ì› ë² íŒ…: {msg}")
    print()
    
    # 2. ìŠ¹ë¥  ì°©ê° ì²´í¬
    print("2ï¸âƒ£  ìŠ¹ë¥  ì°©ê° ì²´í¬")
    test_records = [
        ([True, True, True], "3ì—°ìŠ¹ (ìƒ˜í”Œ ë¶€ì¡±)"),
        ([True, False, True, False, True, False, True, False, True, False], "5ìŠ¹ 5íŒ¨"),
        ([True] * 7 + [False] * 3, "7ìŠ¹ 3íŒ¨"),
        ([False] * 7 + [True] * 3, "3ìŠ¹ 7íŒ¨"),
    ]
    
    for trades, desc in test_records:
        msg = reality.check_win_rate_delusion(trades)
        print(f"   ğŸ“Š {desc}: {msg}")
    print()
    
    # 3. ë³µìˆ˜ ë§¤ë§¤ ì²´í¬
    print("3ï¸âƒ£  ë³µìˆ˜ ë§¤ë§¤ ì²´í¬")
    test_scenarios = [
        (False, 2.0, "ì†ì‹¤ í›„ 2ë°° ë² íŒ…"),
        (False, 1.3, "ì†ì‹¤ í›„ 1.3ë°° ë² íŒ…"),
        (True, 1.5, "ìˆ˜ìµ í›„ 1.5ë°° ë² íŒ…"),
        (False, 1.0, "ì†ì‹¤ í›„ ë™ì¼ ë² íŒ…"),
    ]
    
    for last_result, multiplier, desc in test_scenarios:
        is_revenge, msg = reality.check_revenge_trading(last_result, multiplier)
        status = "ğŸš¨" if is_revenge else "âœ…"
        print(f"   {status} {desc}: {msg}")
    print()
    
    print("=" * 60)
    print("ğŸ¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
    print("=" * 60)
    print()
    print("ë§ˆì§€ë§‰ ì¡°ì–¸:")
    print("- ì´ ê²€ì¦ê¸°ë¥¼ í†µê³¼í–ˆë‹¤ê³  ë¬´ì¡°ê±´ ìˆ˜ìµì´ ë‚˜ëŠ” ê±´ ì•„ë‹™ë‹ˆë‹¤.")
    print("- ì†ì ˆê°€ëŠ” ë°˜ë“œì‹œ ì„¤ì •í•˜ì„¸ìš”. (ë‹¹ì‹ ì˜ ìì¡´ì‹¬ë³´ë‹¤ ì¤‘ìš”í•©ë‹ˆë‹¤)")
    print("- ì›”ê¸‰ ì „ì•¡ íˆ¬ìëŠ” ì ˆëŒ€ ê¸ˆì§€. (ê°€ì¡±ì´ ìˆë‹¤ë©´ ë”ë”ìš±)")
    print("- ë³µìˆ˜ ë§¤ë§¤ëŠ” íŒŒì‚°ì˜ ì§€ë¦„ê¸¸. (ê°ì •ì€ ì§‘ì— ë‘ê³  ì˜¤ì„¸ìš”)")
    print("- ë¡œë˜ 1ë“± í™•ë¥ : 1/8,145,060")
    print("  ë‹¹ì‹ ì˜ 'ì´ë²ˆì—” ë‹¤ë¥´ë‹¤' í™•ë¥ : ë¹„ìŠ·í•¨")
    print()
    print("ê·¸ëŸ¼ì—ë„ ë§¤ë§¤í•˜ì‹œê² ë‹¤ë©´... í–‰ìš´ì„ ë¹•ë‹ˆë‹¤. ì§„ì‹¬ìœ¼ë¡œ. ğŸ€")
    print("(í•˜ì§€ë§Œ í–‰ìš´ì— ê¸°ëŒ€ëŠ” ìˆœê°„ ë‹¹ì‹ ì€ íˆ¬ììê°€ ì•„ë‹ˆë¼ ë„ë°•ê¾¼ì…ë‹ˆë‹¤)")
    print()
    print("=" * 60)
